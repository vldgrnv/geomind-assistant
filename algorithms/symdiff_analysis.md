# Симметричная разность (Symmetrical Difference) пространственных слоёв

## 1. Введение и теоретические основы

Симметричная разность (англ. *symmetrical difference*) — это фундаментальная операция overlay-анализа, направленная на выявление **областей, принадлежащих исключительно одному из двух сравниваемых слоёв, но не их пересечению**. С геометрической точки зрения, данная операция представляет собой объединение двух разностей множеств:  
\[
C = (A \setminus B) \cup (B \setminus A)
\]  
где \( A \) и \( B \) — исходные полигональные слои, а \( C \) — результирующий слой, содержащий только те территории, которые **не совпадают** между двумя исходными наборами данных.

В контексте геоинформационных систем симметричная разность служит мощным инструментом для **оценки динамики изменений**, **выявления расхождений в зонировании** и **контроля качества данных**. Например, она позволяет определить, какие участки леса были вырублены за год, какие границы кадастровых кварталов изменились при актуализации, или где возникли конфликты между утверждённым генеральным планом и фактической застройкой. Операция реализует логическую функцию **исключающего ИЛИ (XOR)** над пространственными объектами, что делает её незаменимой при сравнительном анализе.

Методологически symdiff относится к классу **топологических операций над векторными данными** и является логическим дополнением к операциям *intersect* и *union*. В отличие от *union*, который сохраняет всё пространство, и *intersect*, который сохраняет только общее, symdiff фокусируется именно на **различиях**, что особенно ценно в задачах мониторинга и аудита.

## 2. Ключевые слова и семантические триггеры

симметричная разность, symdiff, различия, XOR, динамика изменений, расхождения, сравнение карт, QGIS Symmetrical Difference, ArcMap нет прямого аналога

## 3. Область применения

- **Мониторинг природных ресурсов**: выявление вырубок леса, деградации почв или изменения береговой линии за определённый период.
- **Кадастровый учёт**: обнаружение расхождений между учётными границами и результатами наземной съёмки.
- **Градостроительное планирование**: оценка соответствия фактической застройки утверждённому зонированию.
- **Экологический аудит**: сравнение границ особо охраняемых природных территорий в разные годы.
- **Управление чрезвычайными ситуациями**: выявление новых зон затопления или пожароопасных территорий по сравнению с предыдущим сезоном.
- **Контроль качества данных**: обнаружение ошибок при оцифровке или миграции данных между системами.

## 4. Входные данные

- **Два полигональных векторных слоя**, представляющих одно и то же явление в разные моменты времени или из разных источников.
- **Единая система координат** (рекомендуется метрическая проекция для корректного расчёта площадей).
- **Топологическая корректность**: отсутствие самопересечений, щелей и наложений внутри каждого слоя.
- **Семантическая сопоставимость**: слои должны относиться к одной тематической категории (например, оба — лесные массивы, оба — границы районов).

> ⚠️ **Важно**: Если один из слоёв содержит объекты, полностью отсутствующие в другом, они будут включены в результат целиком.

## 5. Выходные данные

- Новый полигональный слой, содержащий **только несовпадающие области**.
- Атрибутивная таблица содержит **все поля из обоих входных слоёв**.
- Для областей, принадлежащих только первому слою, поля второго слоя заполняются как NULL, и наоборот.
- Геометрия объектов точно соответствует разностным частям исходных слоёв.

## 6. Программная реализация

### 6.1. QGIS (версия 3.28+)
- **Путь**: Вектор → Инструменты геообработки → Симметричная разность...
- **Параметры**:
  - Input layer: первый полигональный слой,
  - Overlay layer: второй полигональный слой,
  - Output: путь к выходному файлу.
- **Особенности**: 
  - Поддерживает только два слоя за один запуск,
  - Автоматически обрабатывает мультиполигоны,
  - Результат сохраняется в CRS первого слоя,
  - Доступен во всех версиях QGIS без ограничений.

### 6.2. ArcMap 

В ArcMap **отсутствует прямой инструмент** «Symmetrical Difference». Однако операцию можно эмулировать через комбинацию стандартных инструментов:

#### Эмуляция через Union + Select:
1. Выполните **Union** двух слоёв (`Analysis Tools → Overlay → Union`).
2. Откройте атрибутивную таблицу результата.
3. Создайте запрос для выбора объектов, где **только один из FID-полей не равен -1**:
("FID_layer1" = -1 AND "FID_layer2" <> -1) OR ("FID_layer1" <> -1 AND "FID_layer2" = -1)
4. Экспортируйте выбранные объекты в новый слой.

#### Особенности:
- Требует лицензию **Advanced (ArcInfo)** для использования Union с атрибутивами.
- В версиях 10.4–10.6 интерфейс выбора по атрибутам менее интуитивен.
- Начиная с 10.7, улучшена работа с NULL-значениями в запросах.
- При большом числе объектов (>50 000) рекомендуется использовать **File Geodatabase**.

#### Типичные сценарии:
- **Анализ динамики лесов**:  
  Input = леса_2020.shp, леса_2025.shp → Output = вырубки_и_восстановление.shp
- **Контроль градостроительства**:  
  Input = генплан_2020.shp, фактическая_застройка_2025.shp → Output = нарушения_зонирования.shp

## 7. Примеры формулировок пользовательских запросов

- «Как найти различия между двумя версиями карты лесов?»
- «Нужно выявить расхождения между кадастром и генпланом»
- «Как в QGIS сделать симметричную разность?»
- «Сравни границы заказника за 2020 и 2025 год»
- «Где появились новые участки застройки по сравнению с прошлым годом?»

## 8. Ограничения и особенности

1. **Требование к типу геометрии**: операция применима **только к полигонам**.
2. **Чувствительность к точности данных**: даже небольшие расхождения в границах (например, из-за погрешностей оцифровки) могут быть интерпретированы как реальные изменения. Рекомендуется предварительно выполнять **snap** или **buffer** с малым радиусом.
3. **Производительность**: при работе с большими наборами данных время выполнения может достигать нескольких минут.
4. **Ограничения ArcMap**: отсутствие прямого инструмента усложняет процесс для пользователей без Advanced-лицензии.
5. **Интерпретация результата**: наличие различий не всегда означает реальные изменения — возможно, это ошибки данных.

## 9. Научно-методическое обоснование

Симметричная разность является логическим продолжением теории множеств в пространственном анализе. В учебниках по ГИС (например, de Smith et al., *Geospatial Analysis*, 2018) данная операция рассматривается как ключевой метод для оценки динамики территориальных процессов и обязательный этап в пайплайнах экологического и урбанистического мониторинга.

## 10. Литература и нормативные источники

- de Smith M. J., Goodchild M. F., Longley P. A. *Geospatial Analysis: A Comprehensive Guide*. — 6th ed. — Locate Press, 2018.
- ISO 19107:2003. *Geographic information — Spatial schema*.
- QGIS Documentation. *Symmetrical Difference*. URL: https://docs.qgis.org
- Esri. *Overlay Analysis*. ArcGIS Desktop Help (версии 10.4–10.8). URL: https://desktop.arcgis.com
