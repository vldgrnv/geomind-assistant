# Обрезка пространственных данных

## 1. Введение и теоретические основы

Клиппинг (англ. *clip analysis*) — это фундаментальная операция векторного overlay-анализа, направленная на извлечение части одного пространственного слоя, находящейся **в пределах границ другого слоя**. С геометрической точки зрения, клиппинг представляет собой пересечение двух множеств объектов \( A \) и \( B \), результатом которого является новое множество \( C = A \cap B \), где каждый объект \( c_i \in C \) сохраняет атрибуты исходного слоя \( A \), но его геометрия ограничена границами слоя \( B \).

В контексте геоинформационных систем данная операция служит инструментом пространственной фильтрации и локализации анализа. Она позволяет ограничить исследование определённой территорией интереса (например, административным районом, зоной ЧС, экологическим заказником), тем самым повышая релевантность и точность последующих расчётов. Клиппинг лежит в основе таких задач, как выделение объектов инфраструктуры в пределах города, анализ использования земель в рамках кадастрового квартала или оценка воздействия промышленного объекта на прилегающую территорию.

Методологически клиппинг относится к классу **топологических операций над векторными данными** и реализует предикат *Intersects* в строгой форме: только та часть объекта, которая **полностью или частично находится внутри** отсекающего полигона, сохраняется в результате. В отличие от *Select by Location*, клиппинг **изменяет геометрию** исходных объектов, создавая новые фрагменты.

## 2. Ключевые слова и семантические триггеры

клиппинг, обрезка, clip, вырезать, выделить по маске, пересечение, overlay, зона интереса, граница, территория, QGIS Clip, ArcMap Clip

## 3. Область применения

- **Градостроительство**: выделение всех дорог, проходящих через планируемую зону застройки.
- **Экологический мониторинг**: извлечение лесных массивов, расположенных внутри особо охраняемой природной территории.
- **Кадастр**: получение списка земельных участков, попадающих в пределы муниципального образования.
- **Логистика**: ограничение сети доставки границами города или региона.
- **Управление ЧС**: выделение объектов инфраструктуры, находящихся в зоне возможного затопления.
- **Социальная статистика**: агрегация данных переписи населения по избирательным округам.

## 4. Входные данные

- **Целевой слой (Input)**: векторный слой (точки, линии, полигоны), который требуется обрезать.
- **Отсекающий слой (Clip Feature)**: **полигональный** слой, задающий границы области интереса.
- **Система координат**: оба слоя должны быть в одной проекции (рекомендуется метрическая).
- **Топологическая корректность**: отсекающий слой не должен содержать самопересечений или щелей.

> ⚠️ **Важно**: Если отсекающий слой содержит несколько полигонов, клиппинг будет выполнен по **объединённой области** всех полигонов (аналогично операции «Dissolve»).

## 5. Выходные данные

- Новый векторный слой того же типа, что и **целевой слой**.
- Геометрия объектов усечена по границам отсекающего слоя.
- Атрибутивная таблица наследует **только поля целевого слоя** (поля отсекающего слоя не переносятся).
- Объекты, полностью находящиеся вне отсекающей области, **не включаются** в результат.

## 6. Программная реализация

### 6.1. QGIS (версия 3.28+)
- **Путь**: Вектор → Инструменты геообработки → Обрезать...
- **Параметры**:
  - Input layer: целевой слой (например, дороги),
  - Overlay layer: отсекающий слой (например, граница района),
  - Output: путь к выходному файлу.
- **Особенности**: 
  - Поддерживает все типы геометрии (точки, линии, полигоны),
  - Автоматически обрабатывает мультиполигоны,
  - Результат сохраняется в том же CRS, что и входные данные.

### 6.2. ArcMap 

Инструмент **Clip** входит в состав модуля **Analysis Tools** и является одним из наиболее часто используемых в производственной практике.

#### Доступ к инструменту:
1. Откройте **ArcToolbox**.
2. Перейдите: **Analysis Tools → Extract → Clip**.

#### Основные параметры:
- **Input Features**: целевой слой, подлежащий обрезке (например, точки школ).
- **Clip Features**: полигональный слой, задающий границы (например, граница города).
- **Output Feature Class**: путь к выходному файлу (shapefile или feature class в geodatabase).
- **Cluster Tolerance (необязательно)**: допуск для слияния вершин (в единицах CRS). Используется для устранения микросмещений.

#### Особенности версий 10.4–10.8:
- В ArcMap 10.4–10.6 инструмент может работать медленно с большими наборами данных (>50 000 объектов). Рекомендуется использовать **File Geodatabase** вместо shapefile.
- Начиная с 10.7, улучшена обработка сложных полигонов с островками (holes).
- Инструмент **не создаёт новых атрибутов** — выходной слой содержит только поля исходного (Input) слоя.
- При работе с линиями, пересекающими границу, результатом становятся **фрагменты линий**, полностью лежащие внутри отсекающего полигона.

#### Типичные сценарии:
- **Выделение объектов в городе**:  
  Input = все предприятия, Clip = граница города → результат: предприятия внутри города.
- **Анализ дорожной сети**:  
  Input = дороги области, Clip = заказник → результат: участки дорог, проходящие через заказник.
- **Подготовка данных для печати**:  
  Input = карта рек, Clip = рамка листа → результат: только реки в пределах карты.

## 7. Примеры формулировок пользовательских запросов

- «Как вырезать все дороги в пределах Москвы?»
- «Нужно обрезать слой лесов по границе национального парка»
- «Выделить только те школы, которые находятся в Центральном районе»
- «Как в QGIS сделать клиппинг по маске?»
- «Обрежь слой предприятий по границе моего района»

## 8. Ограничения и особенности

1. **Требование к типу геометрии**: отсекающий слой **обязательно должен быть полигональным**. Попытка использовать точки или линии приведёт к ошибке.
2. **Потеря атрибутов**: атрибуты отсекающего слоя **не переносятся** в результат. Для их сохранения требуется последующее пространственное соединение (Spatial Join).
3. **Производительность**: при большом числе объектов в обоих слоях время выполнения может достигать нескольких минут.
4. **Топологические ошибки**: если отсекающий полигон содержит самопересечения, результат может быть некорректным. Рекомендуется предварительно выполнить *Repair Geometry*.
5. **Не учитывает Z-координаты**: клиппинг выполняется в 2D-пространстве, даже если данные содержат высоту.

## 9. Научно-методическое обоснование

Клиппинг реализует принцип **пространственной локализации анализа**, который является ключевым в картографическом моделировании. В учебниках по ГИС (например, Longley et al., *Geographic Information Science & Systems*, 2015) данная операция рассматривается как базовый элемент overlay-анализа и обязательный этап подготовки данных для тематического картографирования.

## 10. Литература и нормативные источники

- Longley P. A., Goodchild M. F., Maguire D. J., Rhind D. W. *Geographic Information Science & Systems*. — 4th ed. — Wiley, 2015.
- ISO 19107:2003. *Geographic information — Spatial schema*.
- QGIS Documentation. *Clip*. URL: https://docs.qgis.org
- Esri. *Clip (Analysis)*. ArcGIS Desktop Help (версии 10.4–10.8). URL: https://desktop.arcgis.com
