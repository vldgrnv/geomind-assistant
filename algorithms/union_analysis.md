# Объединение с наложением (Union) пространственных слоёв

## 1. Введение и теоретические основы

Объединение с наложением (англ. *union*) — это фундаментальная операция overlay-анализа, направленная на создание **полного разбиения пространства**, охватываемого двумя или более полигональными слоями, с сохранением всех возможных комбинаций пересечений и исключений. С геометрической точки зрения, union представляет собой объединение множеств объектов \( A \) и \( B \), результатом которого является новое множество \( C = A \cup B \), где каждый объект \( c_i \in C \) соответствует либо:
- области, принадлежащей только \( A \),
- области, принадлежащей только \( B \),
- области, принадлежащей одновременно \( A \cap B \).

В отличие от *intersect*, который сохраняет только общие части, union **сохраняет всю территорию**, покрытую хотя бы одним из входных слоёв. Это делает его мощным инструментом для комплексного анализа зонирования, выявления конфликтов использования территории и построения полных карт покрытия.

В контексте геоинформационных систем операция union лежит в основе таких задач, как интеграция кадастровых и градостроительных зон, анализ совместимости функциональных территориальных зон, выявление «белых пятен» в планировании или построение единой карты рисков на основе нескольких источников.

Методологически union относится к классу **топологических операций над векторными данными** и реализует принцип **полного покрытия пространства**. Результат всегда представляет собой **полигональный слой**, даже если исходные данные содержали другие типы геометрии (в этом случае требуется предварительное преобразование).

## 2. Ключевые слова и семантические триггеры

объединение с наложением, union, overlay, полное покрытие, зонирование, QGIS Union, ArcMap Union

## 3. Область применения

- **Градостроительство**: интеграция функциональных зон и кадастровых границ для выявления конфликтов.
- **Экологический мониторинг**: объединение зон охраны, рекреации и хозяйственного использования для комплексной оценки территории.
- **Кадастр**: построение единой карты землепользования на основе данных разных ведомств.
- **Управление ЧС**: объединение зон затопления, пожароопасности и сейсмической активности для оценки совокупного риска.
- **Социальная статистика**: создание единой сетки районов на основе пересечения административных и избирательных границ.
- **Логистика**: анализ полного покрытия зон доставки нескольких курьерских служб.

## 4. Входные данные

- **Два или более полигональных слоя** (union применим **только к полигонам**).
- **Единая система координат** (рекомендуется метрическая проекция).
- **Топологическая корректность**: отсутствие самопересечений, щелей и наложений внутри каждого слоя.

> ⚠️ **Важно**: Если объекты одного слоя частично перекрывают объекты другого, результат будет содержать **отдельные полигоны** для каждой уникальной комбинации перекрытий.

## 5. Выходные данные

- Новый полигональный слой, представляющий полное разбиение пространства.
- Атрибутивная таблица содержит **все поля из всех входных слоёв**.
- Для областей, принадлежащих только одному слою, поля другого слоя заполняются как NULL.
- Каждый полигон в результате имеет **уникальную комбинацию атрибутов**, отражающую его происхождение.

## 6. Программная реализация

### 6.1. QGIS (версия 3.28+)
- **Путь**: Вектор → Инструменты геообработки → Объединить с наложением...
- **Параметры**:
  - Input layer: первый полигональный слой,
  - Overlay layer: второй полигональный слой,
  - Output: путь к выходному файлу.
- **Особенности**: 
  - Поддерживает только два слоя за один запуск,
  - Автоматически обрабатывает мультиполигоны,
  - Результат сохраняется в CRS первого слоя.

### 6.2. ArcMap (версии 10.4–10.8)

Инструмент **Union** входит в состав модуля **Analysis Tools → Overlay** и является одним из наиболее мощных инструментов для анализа зонирования.

#### Доступ к инструменту:
1. Откройте **ArcToolbox**.
2. Перейдите: **Analysis Tools → Overlay → Union**.

#### Основные параметры:
- **Input Features**: список полигональных слоёв (до 10 слоёв).
- **Output Feature Class**: путь к выходному файлу.
- **Join Attributes**: 
  - *ALL* — все атрибуты из всех слоёв (по умолчанию),
  - *NO_FID* — без полей FID.
- **Gaps Allowed**: 
  - *TRUE* — сохранять области, не покрытые ни одним слоем (по умолчанию),
  - *FALSE* — игнорировать такие области.

#### Особенности версий 10.4–10.8:
- В ArcMap 10.4–10.6 инструмент может генерировать большое число мелких фрагментов (slivers) при неточной топологии. Рекомендуется использовать **topology rules** или последующий инструмент *Eliminate*.
- Начиная с 10.7, улучшена производительность при работе с большими наборами данных (>50 000 полигонов).
- При работе с File Geodatabase результат сохраняет все исходные атрибуты без потерь.
- Инструмент **не работает с точками и линиями** — только с полигонами.

#### Типичные сценарии:
- **Анализ зонирования**:  
  Input = функциональные_зоны.shp, кадастр.shp → Output = зоны_с_конфликтами.shp
- **Экологическая оценка**:  
  Input = заказник.shp, зона_рекреации.shp → Output = полное_покрытие.shp
- **Управление рисками**:  
  Input = зона_затопления.shp, зона_пожара.shp → Output = совокупный_риск.shp

## 7. Примеры формулировок пользовательских запросов

- «Как объединить кадастр и градостроительные зоны с наложением?»
- «Нужно создать полную карту покрытия двух слоёв зон»
- «Как в QGIS сделать union двух полигональных слоёв?»
- «Объедини слой заказника и слой рекреационных зон»
- «Какие участки не покрыты ни одной зоной?»

## 8. Ограничения и особенности

1. **Требование к типу геометрии**: union применим **только к полигонам**. Попытка использовать точки или линии приведёт к ошибке.
2. **Взрыв комбинаторики**: при пересечении сложных слоёв число выходных полигонов может многократно превышать сумму входных.
3. **Чувствительность к топологии**: даже небольшие щели или наложения могут породить сотни микроскопических фрагментов.
4. **Производительность**: время выполнения растёт экспоненциально с увеличением числа объектов и слоёв.
5. **Ограничения ArcMap**: в версиях до 10.7 отсутствует опция автоматического устранения slivers.

## 9. Научно-методическое обоснование

Union является классической операцией **overlay-анализа**, восходящей к ранним ГИС-системам (например, Canadian GIS). В учебниках по ГИС (например, Longley et al., *Geographic Information Science & Systems*, 2015) union рассматривается как ключевой метод для комплексного анализа территориального планирования и обязательный этап в пайплайнах экологической и урбанистической оценки.

## 10. Литература и нормативные источники

- Longley P. A., Goodchild M. F., Maguire D. J., Rhind D. W. *Geographic Information Science & Systems*. — 4th ed. — Wiley, 2015.
- ISO 19107:2003. *Geographic information — Spatial schema*.
- QGIS Documentation. *Union*. URL: https://docs.qgis.org
- Esri. *Union (Analysis)*. ArcGIS Desktop Help (версии 10.4–10.8). URL: https://desktop.arcgis.com
