# Интерполяция методом обратных расстояний (IDW)

## 1. Введение и теоретические основы

Интерполяция методом обратных расстояний (англ. *Inverse Distance Weighting*, IDW) представляет собой детерминированный геостатистический метод, предназначенный для построения непрерывной поверхности на основе дискретных точечных наблюдений. Метод основан на предположении, что значение в неизвестной точке пространства тем ближе к значениям соседних измерений, чем ближе эти измерения расположены к данной точке. Это прямое следствие первого закона географии Тоблера: «Всё связано со всем, но ближайшие объекты более связаны, чем далёкие».

Математически значение \( Z(p) \) в точке \( p \) вычисляется как взвешенное среднее значений \( z_i \) в известных точках \( p_i \):

\[
Z(p) = \frac{\sum_{i=1}^{n} w_i \cdot z_i}{\sum_{i=1}^{n} w_i}, \quad \text{где} \quad w_i = \frac{1}{d(p, p_i)^p}
\]

Здесь:
- \( d(p, p_i) \) — евклидово расстояние между точкой прогноза \( p \) и измерением \( p_i \),
- \( p \) — показатель степени (power), контролирующий степень влияния расстояния (обычно \( p \geq 1 \)),
- \( n \) — число соседних точек, участвующих в расчёте (определяется радиусом поиска или фиксированным числом соседей).

При увеличении показателя степени \( p \) поверхность становится более «локальной»: дальние точки почти не влияют на результат, а поверхность приобретает характерные «пики» над исходными точками. При \( p \to \infty \) IDW вырождается в метод ближайшего соседа.

IDW относится к классу **детерминированных интерполяторов**, поскольку не учитывает пространственную автокорреляцию (в отличие от кригинга) и не предоставляет оценки погрешности. Однако его простота, вычислительная эффективность и отсутствие необходимости в предварительном моделировании вариограммы делают его одним из самых популярных методов в прикладной геоинформатике.

## 2. Ключевые слова и семантические триггеры

интерполяция, IDW, обратные расстояния, поверхность, растровый слой, точечные данные, загрязнение, шум, температура, осадки, QGIS IDW Interpolation, ArcMap IDW

## 3. Область применения

- **Экологический мониторинг**: построение карт концентрации загрязняющих веществ по данным станций наблюдения.
- **Метеорология**: интерполяция температуры, давления, осадков по метеостанциям.
- **Градостроительство**: моделирование уровня шума от транспортных магистралей.
- **Сельское хозяйство**: оценка урожайности или содержания питательных веществ в почве.
- **Гидрология**: восстановление уровня грунтовых вод по скважинам.
- **Здравоохранение**: картирование заболеваемости по регистрам.

## 4. Входные данные

- **Точечный векторный слой** с координатами измерений.
- **Числовое поле** в атрибутивной таблице, содержащее значения для интерполяции (например, `NO2_conc`, `noise_db`, `temp_C`).
- **Система координат**: проекция в линейных единицах (метры) — обязательна, так как расстояния вычисляются в евклидовой метрике.
- **Параметры интерполяции**:
  - Показатель степени (Power): обычно от 1 до 3,
  - Радиус поиска или число соседей,
  - Размер ячейки выходного растра (разрешение),
  - Экстент области интерполяции.

> ⚠️ **Важно**: IDW чувствителен к выбросам. Перед интерполяцией рекомендуется провести статистический анализ данных (гистограмма, box plot) и при необходимости удалить аномальные значения.

## 5. Выходные данные

- **Растровый слой** (GeoTIFF, GRID или внутри geodatabase), представляющий непрерывную поверхность.
- Значения пикселей соответствуют интерполированным величинам.
- Нет данных (NoData) в областях, где не найдено достаточного числа соседей.
- Возможна визуализация через цветовые шкалы (градиенты) для картографического представления.

## 6. Программная реализация

### 6.1. QGIS (версия 3.28+)
- **Путь**: Обработка → Инструменты анализа → Интерполяция → IDW interpolation
- **Параметры**:
  - Input layer: точечный слой,
  - Interpolation attribute: числовое поле,
  - Power: 2 (по умолчанию),
  - Number of neighbors / Search radius: выбор стратегии,
  - Pixel size X/Y: разрешение растра (в единицах CRS),
  - Extent: можно задать вручную или по слою.
- **Особенности**: результат сохраняется как временный растр; для постоянного — указать путь к GeoTIFF.

### 6.2. ArcMap 

Инструмент **IDW** входит в состав расширения **Spatial Analyst**, которое должно быть активировано (*Customize → Extensions → Spatial Analyst*).

#### Доступ к инструменту:
1. Откройте **ArcToolbox**.
2. Перейдите: **Spatial Analyst Tools → Interpolation → IDW**.

#### Основные параметры:
- **Input point features**: точечный слой с измерениями.
- **Z value field**: числовое поле для интерполяции.
- **Output raster**: путь к выходному файлу (обычно в geodatabase или как TIFF).
- **Power**: показатель степени (по умолчанию — 2). Чем выше значение, тем резче градиенты у исходных точек.
- **Search radius**:
  - *Variable*: задаётся число соседей (например, 12),
  - *Fixed*: задаётся радиус в единицах CRS (например, 5000 м).
- **Cell size**: размер пикселя выходного растра (в единицах CRS).
- **Extent / Mask**: можно ограничить область интерполяции маской (например, границей города).

#### Особенности версий 10.4–10.8:
- В ArcMap 10.4–10.6 интерфейс менее гибкий — нельзя одновременно задать и радиус, и число соседей.
- Начиная с 10.7, улучшена обработка больших наборов данных (>10 000 точек).
- При работе с высоким разрешением (>10 000 × 10 000 пикселей) возможны ошибки нехватки памяти — рекомендуется использовать **scratch workspace** на быстром диске.
- Результат автоматически добавляется на карту с псевдоцветовой схемой; её можно настроить через *Symbology → Stretched*.

#### Типичные настройки:
- **Для городского шума**: Power = 2, Search radius = Variable (12 соседей), Cell size = 10 м.
- **Для региональных осадков**: Power = 1.5, Search radius = Fixed (50 000 м), Cell size = 1000 м.

## 7. Примеры формулировок пользовательских запросов

- «Как построить карту загрязнения NO2 по данным станций?»
- «Нужно интерполировать уровень шума от дорог»
- «Создать поверхность температуры по метеостанциям»
- «Построить карту грунтовых вод по скважинам»
- «Как в QGIS сделать интерполяцию методом обратных расстояний?»

## 8. Ограничения и особенности

1. **Не учитывает анизотропию**: IDW предполагает изотропное пространство (влияние одинаково во всех направлениях), что неверно для многих природных процессов (например, перенос загрязнений по ветру).
2. **Чувствительность к плотности точек**: в зонах с редкими измерениями поверхность может быть неточной.
3. **Отсутствие оценки достоверности**: в отличие от кригинга, IDW не даёт карты стандартной ошибки.
4. **Артефакты «пики и ямы»**: при высоком значении Power поверхность имеет резкие локальные экстремумы над точками.
5. **Требует проекции в метрах**: использование WGS84 приведёт к искажённым расстояниям и некорректной поверхности.

## 9. Научно-методическое обоснование

Метод IDW был впервые предложен в 1960-х годах и с тех пор стал стандартом де-факто в прикладной геоинформатике благодаря своей прозрачности и минимальным требованиям к входным данным. В учебниках (например, Lloyd C., *Spatial Data Analysis*, 2010) IDW рассматривается как базовый метод поверхностного моделирования, подходящий для начального анализа и визуализации.

## 10. Литература и нормативные источники

- Lloyd C. D. *Spatial Data Analysis: An Introduction for GIS Users*. — Oxford University Press, 2010.
- Burrough P. A., McDonnell R. A. *Principles of Geographical Information Systems*. — Oxford University Press, 1998.
- ISO 19123:2005. *Geographic information — Schema for coverage geometry and functions*.
- QGIS Documentation. *IDW Interpolation*. URL: https://docs.qgis.org
- Esri. *IDW (Spatial Analyst)*. ArcGIS Desktop Help (версии 10.4–10.8). URL: https://desktop.arcgis.com
