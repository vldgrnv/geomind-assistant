# Тождественное наложение (Identity) пространственных слоёв

## 1. Введение и теоретические основы

Тождественное наложение (англ. *identity*) — это операция overlay-анализа, направленная на **сохранение всех объектов целевого слоя с добавлением атрибутов и геометрических фрагментов из пересекающихся объектов второго слоя**. С геометрической точки зрения, identity представляет собой комбинацию:
- полного сохранения целевого слоя \( A \),
- наложения на него пересечений с отсекающим слоем \( B \).

Формально результат можно выразить как:  
\[
C = A \cup (A \cap B)
\]  
где \( A \) — целевой слой, \( B \) — отсекающий слой, а \( C \) — результирующий слой, содержащий **все исходные объекты \( A \)**, но с разбиением тех частей, которые пересекаются с \( B \), и присоединением атрибутов из \( B \).

В контексте геоинформационных систем данная операция служит инструментом **обогащения данных без потери исходной информации**. Например: привязка характеристик зонирования к земельным участкам, добавление экологических характеристик заказника к лесным массивам, или наложение данных о рисках на объекты инфраструктуры. Identity гарантирует, что **ни один объект из целевого слоя не будет потерян**, даже если он не пересекается с отсекающим слоем.

Методологически тождественное наложение относится к классу **топологических операций над векторными данными** и реализует принцип **асимметричного overlay**: целевой слой доминирует по площади, а отсекающий — по атрибутивному обогащению. Это делает identity незаменимым при подготовке данных для последующего анализа, где важна полнота исходной выборки.

## 2. Ключевые слова и семантические триггеры

тождественное наложение, identity, наложение с сохранением, обогащение данных, QGIS нет прямого аналога, ArcMap Identity

## 3. Область применения

- **Кадастровый учёт**: привязка функциональных зон генплана к земельным участкам.
- **Экологический мониторинг**: добавление характеристик заказника к лесным массивам.
- **Градостроительство**: наложение зон реконструкции на существующую застройку.
- **Управление ЧС**: привязка зон риска к объектам инфраструктуры.
- **Социальная статистика**: добавление демографических характеристик районов к школам и больницам.
- **Логистика**: наложение зон платного въезда на сеть доставки.

## 4. Входные данные

- **Целевой слой (Input)**: векторный слой (точки, линии, полигоны), подлежащий обогащению.
- **Отсекающий слой (Identity Feature)**: **полигональный** слой, задающий зоны для наложения.
- **Единая система координат** (рекомендуется метрическая проекция).
- **Топологическая корректность**: отсутствие самопересечений в отсекающем слое.

> ⚠️ **Важно**: Отсекающий слой **обязательно должен быть полигональным**, так как именно его границы определяют зоны разбиения целевого слоя.

## 5. Выходные данные

- Новый векторный слой того же типа, что и **целевой слой**.
- Геометрия объектов целевого слоя **разбита** по границам отсекающего слоя.
- Атрибутивная таблица содержит **все поля из обоих слоёв**:
  - Для частей, не пересекающихся с отсекающим слоем, поля \( B \) заполняются как NULL,
  - Для пересекающихся частей — значения из \( B \).
- Все исходные объекты \( A \) сохранены (возможно, в виде фрагментов).

## 6. Программная реализация

### 6.1. QGIS (версия 3.28+)

В QGIS **отсутствует прямой инструмент** «Identity». Однако операцию можно эмулировать через:

1. **Intersection** целевого и отсекающего слоёв:  
   `Вектор → Инструменты геообработки → Пересечение...`
2. **Erase** целевого слоя по отсекающему:  
   `Вектор → Инструменты геообработки → Разность...`
3. **Merge** результатов intersection и erase:  
   `Обработка → Инструменты анализа → Объединить векторные слои...`

#### Особенности:
- Требует трёхэтапной обработки,
- Атрибутивные таблицы требуют ручного выравнивания (добавление пустых полей),
- Доступен во всех версиях QGIS без ограничений.

### 6.2. ArcMap (версии 10.4–10.8)

Инструмент **Identity** входит в состав модуля **Analysis Tools → Overlay**, но **требует лицензию Advanced (ArcInfo)**.

#### Доступ к инструменту:
1. Откройте **ArcToolbox**.
2. Перейдите: **Analysis Tools → Overlay → Identity**.

#### Основные параметры:
- **Input Features**: целевой слой (сохраняется полностью).
- **Identity Features**: отсекающий полигональный слой.
- **Output Feature Class**: путь к выходному файлу.
- **Join Attributes**:
  - *ALL* — все атрибуты из обоих слоёв (по умолчанию),
  - *NO_FID* — без полей FID.
- **Relationship** (необязательно): создание таблицы отношений между исходными и результирующими объектами.

#### Особенности версий 10.4–10.8:
- В ArcMap 10.4–10.6 инструмент может генерировать большое число фрагментов при сложной топологии. Рекомендуется использовать **File Geodatabase**.
- Начиная с 10.7, улучшена производительность при работе с большими наборами данных (>50 000 объектов).
- При работе с точками и линиями результат сохраняет их тип, но разбивает только при точном совпадении с границами полигонов.
- Инструмент **сохраняет все исходные объекты**, даже если они не пересекаются с отсекающим слоем.

#### Типичные сценарии:
- **Привязка зонирования**:  
  Input = участки.shp, Identity = функциональные_зоны.shp → Output = участки_с_зонами.shp
- **Экологическое обогащение**:  
  Input = леса.shp, Identity = заказник.shp → Output = леса_с_статусом.shp

## 7. Примеры формулировок пользовательских запросов

- «Как привязать функциональные зоны к земельным участкам без потери данных?»
- «Нужно добавить характеристики заказника к лесным массивам»
- «Как в ArcMap сделать identity?»
- «Наложи зоны риска на объекты инфраструктуры»
- «Обогати слой школ данными о районах»

## 8. Ограничения и особенности

1. **Требование к лицензии ArcMap**: identity доступен только в Advanced-версии.
2. **Требование к типу геометрии**: отсекающий слой **обязательно должен быть полигональным**.
3. **Взрыв фрагментации**: при сложных границах число выходных объектов может многократно превышать исходное.
4. **Производительность**: время выполнения растёт экспоненциально с увеличением числа объектов.
5. **Ограничения QGIS**: отсутствие прямого инструмента усложняет процесс для пользователей без опыта.

## 9. Научно-методическое обоснование

Тождественное наложение является ключевым элементом **подготовки данных для пространственного моделирования**, обеспечивая полноту исходной выборки и обогащение контекстом. В учебниках по ГИС (например, de Smith et al., *Geospatial Analysis*, 2018) identity рассматривается как базовая операция для интеграции разнородных данных в единый аналитический набор.

## 10. Литература и нормативные источники

- de Smith M. J., Goodchild M. F., Longley P. A. *Geospatial Analysis: A Comprehensive Guide*. — 6th ed. — Locate Press, 2018.
- ISO 19107:2003. *Geographic information — Spatial schema*.
- QGIS Documentation. *Intersection, Difference, Merge Vector Layers*. URL: https://docs.qgis.org
- Esri. *Identity (Analysis)*. ArcGIS Desktop Help (версии 10.4–10.8). URL: https://desktop.arcgis.com
