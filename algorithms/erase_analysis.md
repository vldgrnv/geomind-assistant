# Вычитание (Erase) пространственных объектов

## 1. Введение и теоретические основы

Вычитание (англ. *erase*) — это фундаментальная операция overlay-анализа, направленная на **удаление части целевого слоя**, находящейся **в пределах границ отсекающего слоя**. С геометрической точки зрения, erase представляет собой разность множеств объектов \( A \setminus B \), где результатом является новое множество \( C \), содержащее только ту часть объектов \( A \), которая **не пересекается** с объектами \( B \).

В контексте геоинформационных систем данная операция служит инструментом **пространственного исключения** и **очистки данных**. Она позволяет, например, исключить зоны застройки из лесного фонда, удалить охранные зоны из участков под застройку или вырезать водные объекты из карты почв. Erase является логическим дополнением к операции *clip*: если clip сохраняет внутреннюю часть, то erase сохраняет внешнюю.

Методологически вычитание относится к классу **топологических операций над векторными данными** и реализует предикат *Disjoint* в строгой форме. В отличие от *select by location*, erase **изменяет геометрию** исходных объектов, создавая новые фрагменты с вырезанными участками.

## 2. Ключевые слова и семантические триггеры

вычитание, erase, удаление по маске, исключение, разность, QGIS Difference, ArcMap Erase

## 3. Область применения

- **Градостроительство**: исключение охранных зон из участков, доступных для застройки.
- **Экологический мониторинг**: удаление водных объектов из карты лесных массивов.
- **Кадастр**: вырезание земель общего пользования из частных владений.
- **Логистика**: исключение платных зон из маршрутов доставки.
- **Управление ЧС**: удаление безопасных зон из карты рисков.
- **Сельское хозяйство**: исключение болотистых участков из земель под посев.

## 4. Входные данные

- **Целевой слой (Input)**: векторный слой (точки, линии, полигоны), из которого требуется удалить часть.
- **Отсекающий слой (Erase Feature)**: **полигональный** слой, задающий зоны для удаления.
- **Система координат**: оба слоя должны быть в одной проекции (рекомендуется метрическая).
- **Топологическая корректность**: отсекающий слой не должен содержать самопересечений.

> ⚠️ **Важно**: Если отсекающий слой содержит несколько полигонов, вычитание будет выполнено по **объединённой области** всех полигонов.

## 5. Выходные данные

- Новый векторный слой того же типа, что и **целевой слой**.
- Геометрия объектов усечена за счёт удаления областей, пересекающихся с отсекающим слоем.
- Атрибутивная таблица наследует **только поля целевого слоя**.
- Объекты, полностью находящиеся внутри отсекающей области, **не включаются** в результат.

## 6. Программная реализация

### 6.1. QGIS (версия 3.28+)
- **Путь**: Вектор → Инструменты геообработки → Разность...
- **Параметры**:
  - Input layer: целевой слой,
  - Overlay layer: отсекающий слой,
  - Output: путь к выходному файлу.
- **Особенности**: 
  - Поддерживает все типы геометрии,
  - Автоматически обрабатывает мультигеометрии,
  - Результат сохраняется в CRS целевого слоя.

### 6.2. ArcMap 

Инструмент **Erase** входит в состав модуля **Analysis Tools → Overlay**, но **требует лицензию Advanced (ArcInfo)**.

#### Доступ к инструменту:
1. Откройте **ArcToolbox**.
2. Перейдите: **Analysis Tools → Overlay → Erase**.

#### Основные параметры:
- **Input Features**: целевой слой.
- **Erase Features**: полигональный слой для вычитания.
- **Output Feature Class**: путь к выходному файлу.

#### Особенности версий 10.4–10.8:
- Инструмент **недоступен** в лицензиях Basic (ArcView) и Standard (ArcEditor) — только Advanced.
- При работе с большими данными рекомендуется использовать **File Geodatabase**.
- Если у пользователя нет Advanced-лицензии, можно эмулировать erase через комбинацию *Union + Select + Delete*.

#### Типичные сценарии:
- **Подготовка земель**:  
  Input = участки_под_застройку.shp, Erase = охранные_зоны.shp → результат: чистые участки.
- **Экологический анализ**:  
  Input = леса.shp, Erase = реки.shp → результат: лес без водных объектов.

## 7. Примеры формулировок пользовательских запросов

- «Как удалить охранные зоны из участков под застройку?»
- «Нужно вырезать реки из карты лесов»
- «Как в QGIS сделать erase?»
- «Исключи водные объекты из слоя почв»
- «Вычитание по маске в ArcMap»

## 8. Ограничения и особенности

1. **Требование к лицензии ArcMap**: erase доступен только в Advanced-версии.
2. **Требование к типу геометрии**: отсекающий слой **обязательно должен быть полигональным**.
3. **Производительность**: при большом числе объектов время выполнения может быть значительным.
4. **Альтернатива в QGIS**: называется «Разность» (Difference), но функционально идентична erase.
5. **Не сохраняет атрибуты отсекающего слоя** — только целевого.

## 9. Научно-методическое обоснование

Вычитание реализует принцип **пространственного исключения**, который является логическим продолжением теории множеств в ГИС. В учебниках (Longley et al., *Geographic Information Science & Systems*, 2015) erase рассматривается как базовая операция для подготовки данных к тематическому анализу.

## 10. Литература и нормативные источники

- Longley P. A., Goodchild M. F., Maguire D. J., Rhind D. W. *Geographic Information Science & Systems*. — 4th ed. — Wiley, 2015.
- QGIS Documentation. *Difference*. URL: https://docs.qgis.org
- Esri. *Erase (Analysis)*. ArcGIS Desktop Help (версии 10.4–10.8). URL: https://desktop.arcgis.com
